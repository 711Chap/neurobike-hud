<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>SmartCycle HUD</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* GPS marker pulse and proximity dot */
    .gps-marker-icon .gps-ring {
      border: 3px solid #22d3ee;
      border-radius: 50%;
      height: 24px; width: 24px;
      transform: translate(-50%, -50%);
      box-shadow: 0 0 15px #22d3ee;
      animation: pulse-ring 1.5s infinite;
    }
    @keyframes pulse-ring {
      0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.8; }
      70% { transform: translate(-50%, -50%) scale(1.8); opacity: 0; }
      100% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
    }
    .prox-dot { height: 14px; width: 14px; border-radius: 9999px; display:inline-block;box-shadow:0 0 10px rgba(0,0,0,0.08);vertical-align:middle;margin-right:8px;transition: transform .18s, box-shadow .18s, background-color .18s;}
    .prox-green { background-color: #16a34a; box-shadow: 0 0 10px rgba(22,163,74,0.35); }
    .prox-yellow { background-color: #f59e0b; box-shadow: 0 0 10px rgba(245,158,11,0.35); }
    .prox-red { background-color: #dc2626; box-shadow: 0 0 12px rgba(220,38,38,0.45); transform: scale(1.2); }
    .prox-pulse { animation: proxPulse 1s infinite ease-in-out; }
    @keyframes proxPulse { 0%{transform:scale(1);opacity:1;}50%{transform:scale(1.35);opacity:.85;}100%{transform:scale(1);opacity:1;} }
    #emergencyOverlay {
      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
      background-color: rgba(255,0,0,0.85); z-index: 2000;
      display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; text-align:center;
      animation: flashRed 0.5s infinite alternate;
    }
    @keyframes flashRed {
      from { background-color: rgba(255,0,0,0.85);}
      to { background-color: rgba(255,0,0,0.65);}
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-100 via-gray-100 to-blue-200 text-gray-900 h-screen w-screen overflow-hidden font-sans flex flex-col transition-colors duration-200 ease-in-out">

<div class="flex-1 grid grid-cols-1 md:grid-cols-5 overflow-hidden relative">

  <!-- HUD overlays container (calories + proximity) -->
  <div class="order-1 md:col-span-1 flex flex-row md:flex-col items-center md:items-start p-1 md:p-4 gap-2 md:gap-3 absolute md:static top-2 left-2 z-[1001]">
    <div id="calorieOverlay" class="bg-white/70 shadow-xl border border-white/80 rounded-xl p-2 md:p-3 flex items-center space-x-2 md:space-x-3 transition-opacity duration-300 text-xs md:text-base w-[100px] md:w-auto">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 md:h-7 md:w-7 text-red-600" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" /></svg>
      <div>
        <span class="text-xs font-medium text-gray-600 uppercase">Calories</span>
        <p class="text-base md:text-xl font-bold text-gray-900 leading-none">
          <span id="overlayCaloriesValue">--</span>
          <span class="text-xs md:text-sm font-semibold text-red-600 ml-1">kcal</span>
        </p>
      </div>
    </div>
    <div id="proximityOverlay" class="bg-white/70 shadow-xl border border-white/80 rounded-xl p-2 md:p-3 flex items-center space-x-2 md:space-x-3 transition-opacity duration-300 text-xs md:text-base w-[100px] md:w-auto">
      <div id="proxDotSmall" class="prox-dot prox-green"></div>
      <div>
        <span class="text-xs font-medium text-gray-600 uppercase">Proximity</span>
        <p class="text-base md:text-xl font-bold text-gray-900 leading-none">
          <span id="overlayProxValue">--</span>
          <span class="text-xs md:text-sm">cm</span>
        </p>
      </div>
    </div>
  </div>

  <!-- Main panels -->
  <div class="order-2 md:col-span-2 flex flex-col space-y-1 md:space-y-4 p-2 md:p-6">
    <div class="flex justify-center items-center py-1 md:py-2 bg-white/30 backdrop-blur-lg shadow-lg border border-white/40 rounded-2xl">
      <h1 class="text-xl md:text-3xl font-bold text-gray-800 my-1 md:my-2">NeuroBike</h1>
    </div>
    <div class="flex-1 flex flex-col justify-center bg-white/30 backdrop-blur-lg shadow-lg border border-white/40 rounded-2xl p-3 md:p-6">
      <h2 class="text-lg md:text-2xl font-bold text-blue-600 tracking-widest">SPEED</h2>
      <div class="flex items-baseline">
        <span id="speedValue" class="text-3xl md:text-7xl font-black text-black" style="line-height: 1;">--</span>
        <span class="text-base md:text-2xl font-semibold text-gray-600 ml-2">km/h</span>
      </div>
    </div>
    <div class="flex flex-col md:grid md:grid-cols-2 gap-2 md:gap-6">
      <div id="crashPanel" class="bg-white/30 backdrop-blur-lg rounded-2xl p-2 md:p-4 text-center shadow-md border-2 border-green-500/30 bg-green-500/10 transition-all duration-300">
        <h3 class="text-xs md:text-sm font-semibold text-gray-700 uppercase tracking-wider">Crash Status</h3>
        <div id="crashStatus" class="text-lg md:text-2xl font-bold text-black mt-1">SAFE</div>
      </div>
      <div id="terrainPanel" class="bg-white/30 backdrop-blur-lg rounded-2xl p-2 md:p-4 text-center shadow-md border-2 border-green-500/30 bg-green-500/10 transition-all duration-300">
        <h3 class="text-xs md:text-sm font-semibold text-gray-700 uppercase tracking-wider">Terrain</h3>
        <div id="terrainStatus" class="text-lg md:text-2xl font-bold text-black mt-1">SMOOTH</div>
      </div>
    </div>
    <div class="bg-white/30 backdrop-blur-lg shadow-lg border border-white/40 rounded-2xl p-2 md:p-6 space-y-1 md:space-y-3">
      <div class="flex items-center justify-between">
        <span class="font-medium text-gray-600">Duration</span>
        <span id="summaryDuration" class="font-semibold text-gray-900 text-base md:text-2xl">--:--:--</span>
        <div class="flex items-center gap-1 md:gap-2 ml-2 md:ml-3">
          <button id="timerStart" title="Start" class="icon-btn h-6 w-6 md:h-9 md:w-9"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-600" viewBox="0 0 24 24" fill="currentColor"><path d="M5 3v18l15-9L5 3z"/></svg></button>
          <button id="timerStop" title="Stop" class="icon-btn h-6 w-6 md:h-9 md:w-9"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-yellow-500" viewBox="0 0 24 24" fill="currentColor"><path d="M6 6h12v12H6z"/></svg></button>
          <button id="timerReset" title="Reset" class="icon-btn h-6 w-6 md:h-9 md:w-9"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-red-500" viewBox="0 0 24 24" fill="currentColor"><path d="M12 6V3L8 7l4 4V8c2.8 0 5 2.2 5 5 0 2.8-2.2 5-5 5s-5-2.2-5-5H6c0 3.9 3.1 7 7 7s7-3.1 7-7c0-3.9-3.1-7-7-7z"/></svg></button>
        </div>
      </div>
      <div class="text-right text-xs md:text-sm text-gray-500">Manual Timer</div>
      <div class="flex justify-between items-baseline text-base md:text-xl pt-2">
        <span class="font-medium text-gray-600">Distance</span>
        <span id="summaryDistance" class="font-semibold text-gray-900">-- km</span>
      </div>
      <div class="flex justify-between items-baseline text-base md:text-xl">
        <span class="font-medium text-gray-600">Avg Speed</span>
        <span id="summaryAvgSpeed" class="font-semibold text-gray-900">-- km/h</span>
      </div>
      <div class="flex justify-between items-baseline text-base md:text-xl">
        <span class="font-medium text-gray-600">Max Speed</span>
        <span id="summaryMaxSpeed" class="font-semibold text-gray-900">-- km/h</span>
      </div>
    </div>
  </div>

  <!-- MAP: order-3 on mobile for largest region -->
  <div class="order-3 md:order-none col-span-1 md:col-span-3 h-[55vh] md:h-full w-full" id="map"></div>
</div>

<!-- Bluetooth connection buttons (top-right, small on mobile) -->
<div class="absolute top-2 right-2 flex flex-row gap-1 md:gap-2 z-[1000]">
  <button type="button" id="connectButton" class="px-2 py-1 md:px-4 md:py-2 bg-white/70 hover:bg-white/90 border border-gray-300/50 text-blue-600 font-semibold rounded-lg shadow-lg transition duration-200 ease-in-out backdrop-blur-lg disabled:opacity-50 disabled:cursor-not-allowed text-xs md:text-base">Connect</button>
  <button type="button" id="disconnectButton" class="px-2 py-1 md:px-4 md:py-2 bg-white/70 hover:bg-white/90 border border-gray-300/50 text-red-600 font-semibold rounded-lg shadow-lg transition duration-200 ease-in-out backdrop-blur-lg disabled:opacity-50 disabled:cursor-not-allowed text-xs md:text-base" disabled>Disconnect</button>
  <div id="connectionStatus" class="px-2 py-1 md:px-4 md:py-2 bg-white/50 text-gray-700 font-medium rounded-lg shadow-lg backdrop-blur-lg text-center border border-white/40 text-xs md:text-base">Disconnected</div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<!-- Insert the rest of your JS code here (all main logic stays same as original) -->
</body>
</html>
